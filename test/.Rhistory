library(reprex)
library(tidyverse)
library(jsonlite)
#test02 -- empty JSON
json_control_2 <- function(metadata_files) {
lapply(
X = metadata_files,
FUN = function(x) tryCatch(
expr = {jsonlite::read_json(x) %>% names()},
error = function(e) TRUE
)
)
}
# test01 -- json format
json_control_1 <- function(metadata_files) {
sapply(
X = metadata_files,
FUN = function(x) tryCatch(
expr = {jsonlite::read_json(x); FALSE},
error = function(e) TRUE
)
) %>% as.logical()
}
#test03 -- Read comments
json_control_3 <- function(metadata_files) {
lapply(
X = metadata_files,
FUN = function(x) tryCatch(
expr = {
x_com <- jsonlite::read_json(x)[["comments"]]
if (x_com == "PUT_HERE_YOUR_COMMENT") {
NULL
} else {
sprintf("%s: %s",basename(x),  x_com)
}
},
error = function(e) TRUE
)
)
}
# duplicated ID?
json_control_4 <- function(metadata_files) {
lapply(
X = metadata_files,
FUN = function(x) tryCatch(
expr = { any(duplicated(names(jsonlite::read_json(x))))},
error = function(e) TRUE
)
) %>% unlist()
}
#TEST ID
metadata_folder <- "metadata/"
metadata_files <- list.files(metadata_folder, full.names = TRUE)
metadata_files
metadata_files[json_control_1(metadata_files)]
#TEST NAME
metadata_folder <- "metadata/"
metadata_files <- list.files(metadata_folder, full.names = TRUE)
metadata_files %>%
json_control_2 %>%
sapply(function(x) any(grepl("PUT_HERE_ID", x))) %>%
which() -> id_error
metadata_files[id_error]
#TEST READ_COMMENTS
metadata_folder <- "metadata/"
metadata_files <- list.files(metadata_folder, full.names = TRUE)
metadata_files %>%
json_control_3 %>%
unlist()
#TEST DUPLICATED ID
metadata_files[json_control_4(metadata_files)]
# monitoring progress :3
tile_monitoring <- function() {
drive_jsonfile <- drive_ls(
path = as_id("1fBGAjZkjPEpPr0p7c-LtJmfbLq3s87RK")
)
see_changes_get_time <- function(x) drive_jsonfile[x,]$drive_resource[[1]]$createdTime
see_changes_get_author <- function(x) drive_jsonfile[x,]$drive_resource[[1]]$lastModifyingUser$displayName
author_img_selection <- sapply(1:nrow(drive_jsonfile), see_changes_get_author)
time_img_selection <- sapply(1:nrow(drive_jsonfile), see_changes_get_time)
remove_cesar <- !author_img_selection == "Cesar Luis Aybar"
author_img_selection <- author_img_selection[remove_cesar] %>%
strsplit(" ") %>%
sapply(function(x) x[[1]][[1]])
time_img_selection <- time_img_selection[remove_cesar] %>% as.POSIXct %>% as.character
img_sel_df <- data_frame(author = author_img_selection, date = as.Date(time_img_selection)) %>%
filter(date > as.Date("2021-02-12")) %>%
group_by(author) %>%
summarise(labels = length(author))
ggplot(img_sel_df, aes(x = author, y = labels)) +
geom_bar(stat="identity") +
theme_classic()
img_sel_df
}
tile_monitoring()
library(ggplot2)
library(tidyverse)
library(googledrive)
tile_monitoring()
library(ggplot2)
library(tidyverse)
library(googledrive)
# monitoring progress :3
tile_monitoring <- function() {
drive_jsonfile <- drive_ls(
path = as_id("1fBGAjZkjPEpPr0p7c-LtJmfbLq3s87RK")
)
see_changes_get_time <- function(x) drive_jsonfile[x,]$drive_resource[[1]]$createdTime
see_changes_get_author <- function(x) drive_jsonfile[x,]$drive_resource[[1]]$lastModifyingUser$displayName
author_img_selection <- sapply(1:nrow(drive_jsonfile), see_changes_get_author)
time_img_selection <- sapply(1:nrow(drive_jsonfile), see_changes_get_time)
remove_cesar <- !author_img_selection == "Cesar Luis Aybar"
author_img_selection <- author_img_selection[remove_cesar] %>%
strsplit(" ") %>%
sapply(function(x) x[[1]][[1]])
time_img_selection <- time_img_selection[remove_cesar] %>% as.POSIXct %>% as.character
img_sel_df <- data_frame(author = author_img_selection, date = as.Date(time_img_selection)) %>%
filter(date > as.Date("2021-02-12")) %>%
group_by(author) %>%
summarise(labels = length(author))
ggplot(img_sel_df, aes(x = author, y = labels)) +
geom_bar(stat="identity") +
theme_classic()
img_sel_df
}
tile_monitoring()
182+88+161
library(ggplot2)
library(tidyverse)
library(googledrive)
# monitoring progress :3
tile_monitoring <- function() {
drive_jsonfile <- drive_ls(
path = as_id("1fBGAjZkjPEpPr0p7c-LtJmfbLq3s87RK")
)
see_changes_get_time <- function(x) drive_jsonfile[x,]$drive_resource[[1]]$createdTime
see_changes_get_author <- function(x) drive_jsonfile[x,]$drive_resource[[1]]$lastModifyingUser$displayName
author_img_selection <- sapply(1:nrow(drive_jsonfile), see_changes_get_author)
time_img_selection <- sapply(1:nrow(drive_jsonfile), see_changes_get_time)
remove_cesar <- !author_img_selection == "Cesar Luis Aybar"
author_img_selection <- author_img_selection[remove_cesar] %>%
strsplit(" ") %>%
sapply(function(x) x[[1]][[1]])
time_img_selection <- time_img_selection[remove_cesar] %>% as.POSIXct %>% as.character
img_sel_df <- data_frame(author = author_img_selection, date = as.Date(time_img_selection)) %>%
filter(date > as.Date("2021-02-12")) %>%
group_by(author) %>%
summarise(labels = length(author))
ggplot(img_sel_df, aes(x = author, y = labels)) +
geom_bar(stat="identity") +
theme_classic()
}
tile_monitoring()
drive_jsonfile <- drive_ls(
path = as_id("1fBGAjZkjPEpPr0p7c-LtJmfbLq3s87RK")
)
drive_jsonfile
# monitoring progress :3
drive_jsonfile$name
duplicated(drive_jsonfile$name)
# monitoring progress :3
sum(duplicated(drive_jsonfile$name))
drive_jsonfile$name
# monitoring progress :3
gsub("metadata_|\\.json$","",drive_jsonfile$name)
# monitoring progress :3
gsub("metadata_|\\.json$","",drive_jsonfile$name) %>% as.numeric()
# monitoring progress :3
plot(gsub("metadata_|\\.json$","",drive_jsonfile$name) %>% as.numeric())
# monitoring progress :3
ddd <- gsub("metadata_|\\.json$","",drive_jsonfile$name) %>% as.numeric()
ddd
ddd[ddd>4000]
ddd
max(ddd)
# monitoring progress :3
ddd <- gsub("metadata_|\\.json$","",drive_jsonfile$name) %>% as.numeric()
drive_jsonfile <- drive_ls(
path = as_id("1fBGAjZkjPEpPr0p7c-LtJmfbLq3s87RK")
)
# monitoring progress :3
ddd <- gsub("metadata_|\\.json$","",drive_jsonfile$name) %>% as.numeric()
ddd[ddd>4000]
ddd
drive_jsonfile <- drive_ls(
path = as_id("1NOxjbbtiyz2UqiJAJz6IsCNaLxOJlErr")
)
drive_jsonfile$name
# monitoring progress :3
ddd <- gsub("point_","",drive_jsonfile$name) %>% as.numeric()
ddd[ddd>4000]
min(ddd[ddd>4000])
min(ddd[ddd<4000])
max(ddd[ddd<4000])
library(ggplot2)
library(lubridate)
library(tidyverse)
library(googledrive)
library(googlesheets4)
googledrive::drive_auth("s1078735@stud.sbg.ac.at")
googlesheets4::gs4_auth("s1078735@stud.sbg.ac.at")
# monitoring progress :3
tile_monitoring <- function() {
drive_jsonfile <- drive_ls(
path = as_id("1fBGAjZkjPEpPr0p7c-LtJmfbLq3s87RK")
)
see_changes_get_time <- function(x) drive_jsonfile[x,]$drive_resource[[1]]$createdTime
see_changes_get_author <- function(x) drive_jsonfile[x,]$drive_resource[[1]]$lastModifyingUser$displayName
author_img_selection <- sapply(1:nrow(drive_jsonfile), see_changes_get_author)
time_img_selection <- sapply(1:nrow(drive_jsonfile), see_changes_get_time)
remove_cesar <- !author_img_selection == "Cesar Luis Aybar"
author_img_selection <- author_img_selection[remove_cesar] %>%
strsplit(" ") %>%
sapply(function(x) x[[1]][[1]])
time_img_selection <- time_img_selection[remove_cesar] %>% as.POSIXct %>% as.character
img_sel_df <- data_frame(author = author_img_selection, date = as.Date(time_img_selection)) %>%
group_by(author, cut(date, "week")) %>%
summarise(labels = length(author)) %>%
ungroup()
names(img_sel_df) <- c("author", "date", "nlabels")
ggplot(img_sel_df, aes(x = date, y = nlabels, group = author, color = author)) +
geom_line(size = 1.5) +
geom_point(size = 2.5) +
ylim(c(0, 300)) +
geom_hline(yintercept = 250, color = "red")
}
# hqlabels monitoring in progress :3
hqlabels_monitoring <- function() {
xls <- read_sheet(
ss = as_sheets_id("1LpW9JY2BdhlQvAObD1BCzoBiliNRnU3fCRWMQJFRvoM"),
range = "A1:F5000"
)
xls_db <- xls %>%
filter(labeler  %in%  c("Jhomira", "Eduardo", "Fernando")) %>%
filter(!is.na(sen2_id))
txls <- table(xls_db[["labeler"]])
df_f <- data_frame(
labeler = names(txls),
points = floor(txls/5)
)
ggplot(df_f, aes(x = labeler, y = points)) +
geom_bar(stat="identity") +
theme_bw()
}
httr::set_config(httr::config( ssl_verifypeer = 0L))
httr::set_config(httr::config(http_version = 0))
hqlabels_monitoring()
httr::set_config(httr::config( ssl_verifypeer = 0L))
httr::set_config(httr::config(http_version = 0))
library(ggplot2)
library(lubridate)
library(tidyverse)
library(googledrive)
library(googlesheets4)
googledrive::drive_auth("s1078735@stud.sbg.ac.at")
googlesheets4::gs4_auth("s1078735@stud.sbg.ac.at")
# monitoring progress :3
tile_monitoring <- function() {
drive_jsonfile <- drive_ls(
path = as_id("1fBGAjZkjPEpPr0p7c-LtJmfbLq3s87RK")
)
see_changes_get_time <- function(x) drive_jsonfile[x,]$drive_resource[[1]]$createdTime
see_changes_get_author <- function(x) drive_jsonfile[x,]$drive_resource[[1]]$lastModifyingUser$displayName
author_img_selection <- sapply(1:nrow(drive_jsonfile), see_changes_get_author)
time_img_selection <- sapply(1:nrow(drive_jsonfile), see_changes_get_time)
remove_cesar <- !author_img_selection == "Cesar Luis Aybar"
author_img_selection <- author_img_selection[remove_cesar] %>%
strsplit(" ") %>%
sapply(function(x) x[[1]][[1]])
time_img_selection <- time_img_selection[remove_cesar] %>% as.POSIXct %>% as.character
img_sel_df <- data_frame(author = author_img_selection, date = as.Date(time_img_selection)) %>%
group_by(author, cut(date, "week")) %>%
summarise(labels = length(author)) %>%
ungroup()
names(img_sel_df) <- c("author", "date", "nlabels")
ggplot(img_sel_df, aes(x = date, y = nlabels, group = author, color = author)) +
geom_line(size = 1.5) +
geom_point(size = 2.5) +
ylim(c(0, 300)) +
geom_hline(yintercept = 250, color = "red")
}
# hqlabels monitoring in progress :3
hqlabels_monitoring <- function() {
xls <- read_sheet(
ss = as_sheets_id("1LpW9JY2BdhlQvAObD1BCzoBiliNRnU3fCRWMQJFRvoM"),
range = "A1:F5000"
)
xls_db <- xls %>%
filter(labeler  %in%  c("Jhomira", "Eduardo", "Fernando")) %>%
filter(!is.na(sen2_id))
txls <- table(xls_db[["labeler"]])
df_f <- data_frame(
labeler = names(txls),
points = floor(txls/5)
)
ggplot(df_f, aes(x = labeler, y = points)) +
geom_bar(stat="identity") +
theme_bw()
}
tile_monitoring()
# Spatial R packages ------------------------------------------------------
library(cptcity)
library(mapview)
library(leaflet)
library(rgee)
library(sf)
# Spatial R packages ------------------------------------------------------
library(cptcity)
library(mapview)
library(leaflet)
library(rgee)
library(sf)
# Initialize Google Earth Engine (Just One time)
ee_Initialize()
# 1. world map ------------------------------------------------------------
image <- ee$Image('CGIAR/SRTM90_V4')
# 1. world map ------------------------------------------------------------
image <- ee$Image('CGIAR/SRTM90_V4')
# 1. world map ------------------------------------------------------------
image <- ee$Image('CGIAR/SRTM90_V4')
image %>% ee_utils_dataset_display()
Map$addLayer(
eeObject = image,
visParams = list(min = 0, max = 5000, palette= cpt(pal = "mpl_inferno")),
name = 'SRTM90_V4'
)
Map$addLayer(
eeObject = image,
visParams = list(min = 0, max = 5000, palette= cpt(pal = "mpl_inferno")),
name = 'SRTM90_V4'
)
# 1. world map ------------------------------------------------------------
image <- ee$Image('CGIAR/SRTM90_V4')
m1 <- Map$addLayer(
eeObject = image,
visParams = list(min = 0, max = 5000, palette= cpt(pal = "mpl_inferno")),
name = 'SRTM90_V4'
)
m1$rgee$tokens
m1 <- Map$addLayer(
eeObject = image,
visParams = list(min = 0, max = 5000, palette= cpt(pal = "mpl_inferno")),
name = 'SRTM90_V4'
)
m1$rgee$tokens
Map$centerObject(image)
Map$addLayer(
eeObject = image,
visParams = list(min = 0, max = 5000, palette= cpt(pal = "mpl_inferno")),
name = 'SRTM90_V4'
)
library(mapedit)
mapedit::editMap()
geom_demo <- mapedit::editMap()
m1 <- Map$addLayer(
eeObject = image,
visParams = list(min = 0, max = 5000, palette= cpt(pal = "mpl_inferno")),
name = 'SRTM90_V4'
)
geom_demo <- mapedit::editMap(m1)
Map$centerObject(image)
m1 <- Map$addLayer(
eeObject = image,
visParams = list(min = 0, max = 5000, palette= cpt(pal = "mpl_inferno")),
name = 'SRTM90_V4'
)
m1
m1 <- Map$addLayer(
eeObject = image,
visParams = list(min = 0, max = 5000, palette= cpt(pal = "mpl_inferno")),
name = 'SRTM90_V4'
)
m2 <- Map$addLayer(
eeObject = image,
visParams = list(min = 0, max = 1000, palette= cpt(pal = "mpl_inferno")),
name = 'SRTM90_V4'
)
m2
m2 <- Map$addLayer(
eeObject = log1p(image),
visParams = list(min = 0, max = 10, palette= cpt(pal = "mpl_inferno")),
name = 'SRTM90_V4'
)
m2
m1 | m2
m2$rgee$tokens
# 2. Load Geometry --------------------------------------------------------
nc <- st_read(system.file("shape/nc.shp", package="sf"))
# 2. Load Geometry --------------------------------------------------------
nc <- st_read(system.file("shape/nc.shp", package="sf"))
nc
m1
library(mapview)
mapview(nc, m1)
nc_elv_90 <- ee_extract(image, nc, scale = 90,sf = TRUE)
nc_elv_1000 <- ee_extract(image, nc, scale = 1000,sf = TRUE)
nc_elv_90$elevation
plot(nc_elv_90$elevation)
plot(nc_elv_1000$elevation)
plot(nc_elv_90$elevation)
plot(nc_elv_1000$elevation)
plot(nc_elv_90$elevation)
plot(nc_elv_1000$elevation)
plot(nc_elv_90$elevation, nc_elv_1000$elevation)
nc_elv_90 <- ee_extract(image, nc, scale = 90,sf = TRUE)
nc_elv_1000 <- ee_extract(image, nc, scale = 5000,sf = TRUE)
plot(nc_elv_90$elevation, nc_elv_1000$elevation)
nc_elv_90 <- ee_extract(image, nc, scale = 10, sf = TRUE)
plot(nc_elv_90$elevation, nc_elv_1000$elevation)
nc_elv_10 <- ee_extract(image, nc, scale = 10, sf = TRUE)
nc_elv_90 <- ee_extract(image, nc, scale = 90, sf = TRUE)
nc_elv_10$elevation - nc_elv_90$elevation
nc_elv_10$elevation - nc_elv_90$elevation
plot(nc_elv_10$elevation - nc_elv_90$elevation)
# Spatial R packages ---------------------------------------------------------------
library(cptcity)
library(raster)
library(rgee)
# Spatial R packages ---------------------------------------------------------------
library(cptcity)
library(raster)
library(rgee)
# 1. world map ------------------------------------------------------------
image <- ee$Image("LANDSAT/LC08/C01/T1/LC08_044034_20140318")
ndvi <- (image[["B5"]] - image[["B4"]])/(image[["B5"]] + image[["B4"]])
names(ndvi) <- "ndvi"
Map$centerObject(image)
Map$addLayer(
eeObject = ndvi,
visParams = list(min = 0, max = 0.7, palette = cpt("grass_ndvi")),
name = 'SRTM90_V4'
)
# 1. world map ------------------------------------------------------------
image <- ee$Image("LANDSAT/LC08/C01/T1/LC08_044034_20140318")
image
ndvi <- (image[["B5"]] - image[["B4"]])/(image[["B5"]] + image[["B4"]])
names(ndvi) <- "ndvi"
# 1. world map ------------------------------------------------------------
image <- ee$Image("LANDSAT/LC08/C01/T1/LC08_044034_20140318")
image
# 1. world map ------------------------------------------------------------
image <- ee$Image("LANDSAT/LC08/C01/T1/LC08_044034_20140318")
image$bandNames()
print(image$bandNames(), type="json")
image$bandNames()$getInfo()
# 1. world map ------------------------------------------------------------
image <- ee$Image("LANDSAT/LC08/C01/T1/LC08_044034_20140318")
ndvi <- (image[["B5"]] - image[["B4"]])/(image[["B5"]] + image[["B4"]])
ndvi <- (image[["B5"]] - image[["B4"]])/(image[["B5"]] + image[["B4"]])
# 1. world map ------------------------------------------------------------
image <- ee$Image("LANDSAT/LC08/C01/T1/LC08_044034_20140318")
ndvi <- (image[["B5"]] - image[["B4"]])/(image[["B5"]] + image[["B4"]])
ndvi
image$bandNames()$getInfo()
length(image$bandNames()$getInfo())
ndvi <- (image[["B5"]] - image[["B4"]])/(image[["B5"]] + image[["B4"]])
length(ndvi)
length(image)
names(ndvi)
ndvi$rename("ndvi")
names(ndvi) <- "ndvi"
names(ndvi)
Map$centerObject(image)
Map$addLayer(
eeObject = ndvi,
visParams = list(min = 0, max = 0.7, palette = cpt("grass_ndvi")),
name = 'SRTM90_V4'
)
# 2. Download Image -------------------------------------------------------
ndvi_raster <- ee_as_raster(ndvi, scale = 1000)
# 2. Download Image -------------------------------------------------------
ndvi_raster <- ee_as_raster(ndvi, scale = 1000,dsn = "/home/csaybar/Desktop/ndvi.tif")
2**8
ndvi_raster
ndvi_raster@history
# 1. world map ------------------------------------------------------------
image <- ee$Image('CGIAR/SRTM90_V4')
image
log1p(image)
image**2 - 100
image$pow(2)$substract(100)
image$pow(2)$subtract(100)
image$pow(2)$subtract(100)
image**2 - 100
image$pow(2)$subtract(100)
image**2 - 100
image**2 - 100
image$pow(2)$subtract(100)
image**2 - 100
image$pow(2)$subtract(100)
image  > 10
Map$addLayer(
image  > 1000
)
Map$addLayer(
image$gt(1000)
)
